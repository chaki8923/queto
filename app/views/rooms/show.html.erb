 <%= javascript_pack_tag 'chat_window' %> 
<h1><%= @room.name %></h1>
<div id="data" data-id="<%= @room.id %>" data-user-id="<%= @current_user.id %>"></div>
  <%= form_with(model: @message,local: false, html:{class: 'form-group'})  do |f| %>
     <%= f.text_field :content,class: 'form-control message' %>
     <%= f.hidden_field :user_id, value: @current_user.id %>
     <%= f.hidden_field :room_id, value: @room.id %>
     <%= f.submit '送信' %>
 <% end %>

<div id="container">
<% @messages.map do |message| %>
  <div class="chat-line <% if message.user_id == @current_user.id %> my <%  else %> you <% end %>" >
      <%if message.user.avatar.blank? %>
        <img src="/assets/default_icon.png" alt="" class="chat_icon">
     <%else%>
        <%= image_tag message.user.avatar.url,class: 'chat_icon'%>
    <%end%>
  <%# ルームの作成者であればメッセージ表示 %>
    <% if message.request_flg.nil? %>
     <span class="message-content"><%= message.content %></span>
    <%else%>
     <%= form_with(url: permission_path(message.user.id), html:{class: 'form-group'}) do |f| %>
        <%= f.hidden_field :user_id, value: message.user.id %>
        <%= f.hidden_field :room_id, value: message.room.id %>
         <%= f.hidden_field :push_user, value: params[:user_id] %>
        <button class="btn btn-danger js-reload-btn"><%= message.content %></button>
      <% end %>
    <%end%>
  </div>
    <%= render partial: 'messages/message', locals: {message: message} %>
<% end %>
</div>

